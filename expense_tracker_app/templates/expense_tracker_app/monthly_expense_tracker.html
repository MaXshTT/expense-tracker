{% extends 'expense_tracker_app/base.html' %}
{% load static %}
{% block title %}Monthly Expense Tracker{% endblock %}
{% block head_extra %}
<!-- SweetAlert2 -->
<link rel="stylesheet" href="{% static 'adminlte/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}">
{% endblock head_extra %}
{% block active_page %}Monthly Expense Tracker{% endblock %}
{% block header_title %}Monthly Expense Tracker{% endblock %}
{% block content %}
<div class="row">
  <div class="col-lg-3 col-6">
    <!-- small box -->
    <div class="small-box bg-success">
      <div class="inner">
        <h3><span class="info" id="daily-spendable">{{ income.get_daily_spendable|floatformat:"-2" }}</span><sup style="font-size: 20px">$</sup></h3>

        <p>Daily Spendable</p>
      </div>
      <div class="icon">
        <i class="fas fa-dollar-sign"></i>
      </div>
      <a href="{% url 'budget' %}" class="small-box-footer">
        More info <i class="fas fa-arrow-circle-right"></i>
      </a>
    </div>
    <!-- /.small box -->
  </div>
  <!-- /.col -->
  <div class="col-lg-3 col-6">
    <!-- small box -->
    <div class="small-box bg-indigo">
      <div class="inner">
        <h3><span class="info" id="monthly-spendable">{{ income.get_monthly_spendable|floatformat:"-2" }}</span><sup style="font-size: 20px">$</sup></h3>

        <p>Monthly Spendable</p>
      </div>
      <div class="icon">
        <i class="fas fa-money-bill-wave"></i>
      </div>
      <a href="{{ budget_url }}" class="small-box-footer">
        More info <i class="fas fa-arrow-circle-right"></i>
      </a>
    </div>
    <!-- /.small box -->
  </div>
  <!-- /.col -->
  <div class="col-lg-3 col-6">
    <!-- small box -->
    <div class="small-box bg-olive">
      <div class="inner">
        <h3><span class="info" id="month-money-left">{{ income.get_month_left_money|floatformat:"-2" }}</span><sup style="font-size: 20px">$</sup></h3>

        <p>Money Left</p>
      </div>
      <div class="icon">
        <i class="fas fa-piggy-bank"></i>
      </div>
      <a class="small-box-footer">
        &nbsp;
      </a>
    </div>
    <!-- /.small box -->
  </div>
  <!-- /.col -->
  <div class="col-lg-3 col-6">
    <!-- small box -->
    <div class="small-box bg-danger">
      <div class="inner">
        <h3><span class="info" id="month-expenses">{{ income.get_sum_monthly_expenses_user|floatformat:"-2" }}</span><sup style="font-size: 20px">$</sup></h3>

        <p>{{ month }}'s Expenses</p>
      </div>
      <div class="icon">
        <i class="fas fa-shopping-cart"></i>
      </div>
      <a class="small-box-footer">
        &nbsp;
      </a>
    </div>
    <!-- /.small box -->
  </div>
  <!-- /.col -->
</div>
<div class="row mb-2">
  <div class="col-sm-12">
    <div class="card card-info">
      <div class="card-header ">
        <h3 class="card-title">Expenses</h3>
        <!-- /.card-tools -->
      </div>
      <!-- /.card-header -->
      <div class="card-body" id="card-categories">
        <div class="row">
        {% for category in categories %}
          <div class="col-xl-6">
            <div class="card">
              <div class="card-header">
                <h3 contenteditable class="category card-title">{{ category }}</h3>
                <div class="card-tools">
                  <button type="button" class="btn btn-tool delete-category" data-toggle="modal" data-target="#modal-delete-category" data-category-id="{{ category.id }}">
                    <i class="fas fa-times" style="color: #adb5bd"></i>
                  </button>
                </div>
              </div>
              <!-- /.card-header -->
              <div class="card-body p-0">
                <table class="table table-striped text-center">
                  <thead>
                    <tr>
                      <th style="width: 5%">#</th>
                      <th style="width: 45%">Name</th>
                      <th style="width: 20%">Cost</th>
                      <th style="width: 25%">Expected Cost</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody class="category-tbody">
                  {% for expense in category.expense_set.all %}
                    <tr>
                      <td>{{ forloop.counter }}.</td>
                      <td class="expense"><span contenteditable class="name">{{ expense.name }}</span></td>
                      <td class="expense"><span contenteditable class="cost">{{ expense.cost|floatformat:"-2" }}</span>$</td>
                      <td class="expense">
                        <span contenteditable class="expected-cost">{% if expense.expected_cost %}{{ expense.expected_cost|floatformat:"-2" }}</span>${% else %}</span>{% endif %}
                      </td>
                      <td class="td-delete">
                        <button type="button" class="btn bg-danger btn-sm btn-delete-expense" data-expense-id="{{ expense.id }}">
                          <i class="fas fa-times"></i>
                        </button>
                      </td>
                    </tr>
                  {% endfor %}
                  {% if category.expense_set.all.count < 20 %}
                    <tr>
                      <td></td>
                      <td><input class="form-control text-center new-expense-name" type="text"></td>
                      <td><input class="form-control text-center new-expense-cost" step="0.01" type="number"></td>
                      <td><input class="form-control text-center new-expense-expected-cost" type="number"></td>
                      <td>
                        <button type="button" class="btn bg-info btn-sm btn-add-expense">
                        <i class="fas fa-plus"></i>
                        </button>
                      </td>
                    </tr>
                  {% endif %}
                  </tbody>
                </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col-->
        {% endfor %}
        {% if categories.count < 16 %}
          <div class="col-xl-6">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">&#8203;</h3>
              </div>
              <!-- /.card-header -->
              <div class="card-body p-0">
                <table class="table table-striped text-center">
                  <thead>
                    <tr>
                      <th style="width: 5%">#</th>
                      <th style="width: 45%">Title</th>
                      <th style="width: 20%">Cost</th>
                      <th style="width: 25%">Day due</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody class="new-category-tbody">
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <!-- /.card-body -->
              <div class="overlay">
                <button type="button" class="btn" data-toggle="modal" data-target="#modal-new-category">
                  <i class="fa fa-2x fa-plus" aria-hidden="true"></i>
                </button>
              </div>
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        {% endif %}
        </div>
        <!-- /.row -->
      </div>
      <!-- /.card-body -->
    </div>
    <!-- /.card -->
  </div>
  <!-- ./col -->
</div>
<!-- ./row -->
<div class="modal fade" id="modal-new-category">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-info">
        <h4 class="modal-title">Add Category</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="color: white;">×</span>
        </button>
      </div>
      <!-- /.modal-header -->
			<div class="modal-body">
        <div class="form-group row">
          <label class="col-sm-2" for="name_category" style="padding-top: 5px;">Name: </label>
          <input class="form-control col-sm-8" type="text" name="name_category" id="new-name-category">
        </div>
			</div>
      <!-- /.modal-body -->
			<div class="modal-footer justify-content-between">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="submit" class="btn btn-info" id="btn-sumbit-category" data-dismiss="modal">Create</button>
			</div>
      <!-- /.modal-footer -->
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="modal fade" id="modal-delete-category">
  <div class="modal-dialog modal-confirm">
    <div class="modal-content">
      <div class="modal-header flex-column">
        <div class="icon-box">
					<i class="fas fa-times"></i>
				</div>
        <h4 class="modal-title w-100">Are you sure?</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="color: white;">×</span>
        </button>
      </div>
      <!-- /.modal-header -->
			<div class="modal-body">
					<p>Do you really want to delete the category? This process cannot be undone.</p>
			</div>
      <!-- /.modal-body -->
			<div class="modal-footer justify-content-center">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-danger bg-danger" id="btn-delete-category" data-dismiss="modal">Delete</button>
			</div>
      <!-- /.modal-footer -->
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<input type="hidden" id="id-user" value="{{ user.id }}">
{% endblock %}
{% block body_extra %}
<!-- js-cookie -->
<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<!-- sweetalert2 -->
<script src="{% static 'adminlte/plugins/sweetalert2/sweetalert2.min.js' %}"></script>
<script src="{% static 'js/monthly_expense_tracker.js' %}"></script>
{% endblock %}